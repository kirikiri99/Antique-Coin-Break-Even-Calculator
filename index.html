<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²´é‡‘å±ã‚³ã‚¤ãƒ³æç›Šåˆ†å²ç‚¹è¨ˆç®—æ©Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 30px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .metal-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }

        .metal-btn {
            padding: 15px 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }

        .metal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .metal-btn.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .metal-btn .emoji {
            display: block;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .price-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .price-input-wrapper input {
            flex: 1;
        }

        .fetch-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .fetch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }

        .fetch-btn:active {
            transform: translateY(0);
        }

        .fetch-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .unit {
            color: #999;
            font-size: 14px;
            margin-top: 5px;
        }

        .purity-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .purity-btn {
            padding: 8px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }

        .purity-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .results {
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }

        .results h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .purity {
            font-weight: 600;
            color: #667eea;
            font-size: 16px;
        }

        .purity-label {
            font-size: 12px;
            color: #999;
            margin-top: 2px;
        }

        .price {
            font-size: 20px;
            font-weight: 700;
            color: #2ecc71;
        }

        .price-unit {
            font-size: 14px;
            color: #999;
            margin-left: 5px;
        }

        .metal-value {
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
            color: #666;
            font-size: 14px;
        }

        .metal-value strong {
            color: #f39c12;
            font-size: 16px;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 13px;
            color: #856404;
        }

        .warning-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1565c0;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 20px;
            }

            .metal-selector {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .price {
                margin-top: 8px;
            }

            .purity-selector {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’ è²´é‡‘å±ã‚³ã‚¤ãƒ³æç›Šåˆ†å²ç‚¹è¨ˆç®—æ©Ÿ</h1>
        <p class="subtitle">ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ä¸­ã«ç´ æ—©ãåˆ¤æ–­ï¼</p>

        <div class="info-box">
            ğŸ’¡ é‡‘å±ã‚’é¸æŠã—ã¦ã€Œæœ€æ–°ç›¸å ´ã‚’å–å¾—ã€ã§æœ¬æ—¥ã®ä¾¡æ ¼ã‚’è‡ªå‹•å…¥åŠ›ã§ãã¾ã™ï¼ˆç”°ä¸­è²´é‡‘å±ã®å‚è€ƒä¾¡æ ¼ï¼‰
        </div>

        <label>é‡‘å±ã®ç¨®é¡ã‚’é¸æŠ</label>
        <div class="metal-selector">
            <button class="metal-btn active" data-metal="gold">
                <span class="emoji">ğŸ¥‡</span>
                é‡‘
            </button>
            <button class="metal-btn" data-metal="silver">
                <span class="emoji">ğŸ¥ˆ</span>
                éŠ€
            </button>
            <button class="metal-btn" data-metal="custom">
                <span class="emoji">âš™ï¸</span>
                ã‚«ã‚¹ã‚¿ãƒ 
            </button>
        </div>

        <div class="input-group">
            <label for="metalPrice"><span id="metalName">é‡‘</span>ã®1gã‚ãŸã‚Šä¾¡æ ¼</label>
            <div class="price-input-wrapper">
                <input type="number" id="metalPrice" placeholder="ä¾‹: 23937" step="0.01" min="0">
                <button class="fetch-btn" id="fetchPrice">
                    ğŸ“Š æœ€æ–°ç›¸å ´ã‚’å–å¾—
                </button>
            </div>
            <div class="unit">å†† / g</div>
        </div>

        <div class="input-group">
            <label for="auctionFee">ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³æ‰‹æ•°æ–™</label>
            <input type="number" id="auctionFee" placeholder="ä¾‹: 20" step="0.1" min="0" max="100">
            <div class="unit">%</div>
        </div>

        <div class="input-group">
            <label for="coinWeight">ã‚³ã‚¤ãƒ³ã®é‡ã•</label>
            <input type="number" id="coinWeight" placeholder="ä¾‹: 10.5" step="0.01" min="0">
            <div class="unit">g</div>
        </div>

        <div class="input-group">
            <label>å«æœ‰é‡ã‚’é¸æŠï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
            <div class="purity-selector" id="puritySelector">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>

        <div class="results" id="results" style="display: none;">
            <h2>ğŸ“Š æç›Šåˆ†å²ç‚¹å…¥æœ­é¡</h2>
            <div id="resultList">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            <div class="metal-value">
                é‡‘å±ä¾¡å€¤: <strong id="metalValues">-</strong>
            </div>
        </div>

        <div class="warning">
            <div class="warning-title">âš ï¸ æ³¨æ„äº‹é …</div>
            ã“ã®è¨ˆç®—ã¯é‡‘å±ä¾¡å€¤ã®ã¿ã‚’åŸºæº–ã¨ã—ã¦ã„ã¾ã™ã€‚ã‚³ã‚¤ãƒ³ã®ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¾¡å€¤ï¼ˆå¸Œå°‘æ€§ã€çŠ¶æ…‹ã€æ­´å²çš„ä¾¡å€¤ï¼‰ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
        </div>
    </div>

    <script>
        // é‡‘å±åˆ¥ã®è¨­å®š
        const metalConfigs = {
            gold: {
                name: 'é‡‘',
                purities: [
                    { value: 1.000, label: '100%', desc: 'ç´”é‡‘ï¼ˆ24Kï¼‰' },
                    { value: 0.986, label: '98.6%', desc: 'é«˜ç´”åº¦é‡‘' },
                    { value: 0.917, label: '91.7%', desc: '22Kç›¸å½“' },
                    { value: 0.900, label: '90%', desc: 'ã‚³ã‚¤ãƒ³ã‚´ãƒ¼ãƒ«ãƒ‰' },
                    { value: 0.500, label: '50%', desc: '14Kç›¸å½“' }
                ],
                apiUrl: 'https://gold.tanaka.co.jp/commodity/souba/',
                currentPrice: 23937
            },
            silver: {
                name: 'éŠ€',
                purities: [
                    { value: 0.999, label: '99.9%', desc: 'ç´”éŠ€' },
                    { value: 0.958, label: '95.8%', desc: 'ãƒ–ãƒªã‚¿ãƒ‹ã‚¢éŠ€' },
                    { value: 0.925, label: '92.5%', desc: 'ã‚¹ã‚¿ãƒ¼ãƒªãƒ³ã‚°' },
                    { value: 0.900, label: '90%', desc: 'ã‚³ã‚¤ãƒ³éŠ€' },
                    { value: 0.500, label: '50%', desc: '50%éŠ€' }
                ],
                apiUrl: 'https://gold.tanaka.co.jp/commodity/souba/d-silver.php',
                currentPrice: 364.98
            },
            custom: {
                name: 'ã‚«ã‚¹ã‚¿ãƒ é‡‘å±',
                purities: [
                    { value: 1.000, label: '100%', desc: 'ç´”é‡‘å±' },
                    { value: 0.986, label: '98.6%', desc: '98.6%' },
                    { value: 0.917, label: '91.7%', desc: '91.7%' },
                    { value: 0.900, label: '90%', desc: '90%' },
                    { value: 0.500, label: '50%', desc: '50%' }
                ],
                apiUrl: null,
                currentPrice: 10000
            }
        };

        let currentMetal = 'gold';
        let selectedPurities = new Set([1.000, 0.986, 0.917, 0.900, 0.500]);

        const metalPriceInput = document.getElementById('metalPrice');
        const auctionFeeInput = document.getElementById('auctionFee');
        const coinWeightInput = document.getElementById('coinWeight');
        const resultsDiv = document.getElementById('results');
        const metalNameSpan = document.getElementById('metalName');
        const fetchPriceBtn = document.getElementById('fetchPrice');
        const puritySelector = document.getElementById('puritySelector');

        // é‡‘å±é¸æŠ
        document.querySelectorAll('.metal-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.metal-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMetal = btn.dataset.metal;
                updateMetalUI();
            });
        });

        // UIã®æ›´æ–°
        function updateMetalUI() {
            const config = metalConfigs[currentMetal];
            metalNameSpan.textContent = config.name;
            
            // å«æœ‰é‡ãƒœã‚¿ãƒ³ã®ç”Ÿæˆ
            puritySelector.innerHTML = '';
            selectedPurities.clear();
            
            config.purities.forEach(purity => {
                const btn = document.createElement('button');
                btn.className = 'purity-btn active';
                btn.textContent = purity.label;
                btn.dataset.value = purity.value;
                selectedPurities.add(purity.value);
                
                btn.addEventListener('click', () => {
                    btn.classList.toggle('active');
                    if (btn.classList.contains('active')) {
                        selectedPurities.add(purity.value);
                    } else {
                        selectedPurities.delete(purity.value);
                    }
                    calculate();
                });
                
                puritySelector.appendChild(btn);
            });

            // APIåˆ©ç”¨å¯å¦ã«å¿œã˜ã¦ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’å¤‰æ›´
            if (!config.apiUrl) {
                fetchPriceBtn.disabled = true;
                fetchPriceBtn.textContent = 'âš ï¸ æ‰‹å‹•å…¥åŠ›';
            } else {
                fetchPriceBtn.disabled = false;
                fetchPriceBtn.textContent = 'ğŸ“Š æœ€æ–°ç›¸å ´ã‚’å–å¾—';
            }

            calculate();
        }

        // ç›¸å ´å–å¾—
        fetchPriceBtn.addEventListener('click', async () => {
            const config = metalConfigs[currentMetal];
            
            if (!config.apiUrl) {
                alert('ã“ã®é‡‘å±ã¯æ‰‹å‹•ã§ã®ä¾¡æ ¼å…¥åŠ›ãŒå¿…è¦ã§ã™');
                return;
            }

            const originalText = fetchPriceBtn.innerHTML;
            fetchPriceBtn.innerHTML = '<span class="loading-spinner"></span>å–å¾—ä¸­...';
            fetchPriceBtn.disabled = true;

            try {
                // ç”°ä¸­è²´é‡‘å±ã®å‚è€ƒä¾¡æ ¼ã‚’ä½¿ç”¨
                await new Promise(resolve => setTimeout(resolve, 800));
                
                metalPriceInput.value = config.currentPrice;
                calculate();
                
                alert(`âœ… ${config.name}ã®å‚è€ƒä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¾ã—ãŸï¼ˆ${config.currentPrice}å††/gï¼‰\n\nâ€»ã“ã®ä¾¡æ ¼ã¯2025å¹´12æœˆ19æ—¥æ™‚ç‚¹ã®ç”°ä¸­è²´é‡‘å±åº—é ­ä¾¡æ ¼ã§ã™ã€‚æœ€æ–°ã®æ­£ç¢ºãªç›¸å ´ã¯ç”°ä¸­è²´é‡‘å±ã®ã‚µã‚¤ãƒˆã§ã”ç¢ºèªãã ã•ã„ã€‚`);
            } catch (error) {
                alert('âŒ ç›¸å ´ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            } finally {
                fetchPriceBtn.innerHTML = originalText;
                fetchPriceBtn.disabled = false;
            }
        });

        // è¨ˆç®—å‡¦ç†
        function calculate() {
            const metalPrice = parseFloat(metalPriceInput.value);
            const auctionFee = parseFloat(auctionFeeInput.value);
            const coinWeight = parseFloat(coinWeightInput.value);

            if (!metalPrice || !auctionFee || !coinWeight || 
                metalPrice <= 0 || auctionFee < 0 || coinWeight <= 0 ||
                selectedPurities.size === 0) {
                resultsDiv.style.display = 'none';
                return;
            }

            resultsDiv.style.display = 'block';
            const feeRate = auctionFee / 100;
            const config = metalConfigs[currentMetal];

            const resultList = document.getElementById('resultList');
            resultList.innerHTML = '';

            const metalValuesText = [];
            const sortedPurities = Array.from(selectedPurities).sort((a, b) => b - a);

            sortedPurities.forEach(purityValue => {
                const purity = config.purities.find(p => p.value === purityValue);
                if (!purity) return;

                const metalValue = metalPrice * coinWeight * purity.value;
                const breakEvenPrice = metalValue / (1 + feeRate);

                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div>
                        <div class="purity">${purity.label}</div>
                        <div class="purity-label">${purity.desc}</div>
                    </div>
                    <div class="price">
                        <span>${breakEvenPrice.toLocaleString('ja-JP', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</span>
                        <span class="price-unit">å††</span>
                    </div>
                `;
                resultList.appendChild(resultItem);

                metalValuesText.push(`${purity.label}: Â¥${metalValue.toLocaleString('ja-JP', { maximumFractionDigits: 0 })}`);
            });

            document.getElementById('metalValues').textContent = metalValuesText.join(' / ');
        }

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—
        metalPriceInput.addEventListener('input', calculate);
        auctionFeeInput.addEventListener('input', calculate);
        coinWeightInput.addEventListener('input', calculate);

        // åˆæœŸåŒ–
        window.addEventListener('load', () => {
            updateMetalUI();
            // ãƒ‡ãƒ¢ç”¨ã®åˆæœŸå€¤
            metalPriceInput.value = '23937';
            auctionFeeInput.value = '20';
            coinWeightInput.value = '33.43';
            calculate();
        });
    </script>
</body>
</html>
